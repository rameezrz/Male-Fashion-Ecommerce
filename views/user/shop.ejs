
<link rel="stylesheet" href="/user/css/modal.css">
<link href="/user/noUiSlider-15.7.1/dist/nouislider.css" rel="stylesheet">
<script src="/user/noUiSlider-15.7.1/dist/nouislider.js"></script>


<style>
     .input-container {
        position: relative;
      }

      .clear-button {
        position: absolute;
        top: 50%;
        right: 8px;
        transform: translateY(-50%);
        cursor: pointer;
        opacity: 0.5;
        transition: opacity 0.3s ease-in-out;
      }

      .clear-button:hover {
        opacity: 1;
      }
</style>

<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__text">
                    <h4>Shop</h4>
                    <div class="breadcrumb__links">
                        <a href="/">Home</a>
                        <span>Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->



<!-- Shop Section Begin -->
<section class="shop spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="shop__sidebar">
                    <div class="shop__sidebar__search">
                            <form id="products-list-form">
                                <div class="input-container">
                                    <input
                                      type="text"
                                      id="searchItem"
                                      name="searchKeyword"
                                      placeholder="Search..."
                                      type="search"
                                      class="input"
                                      oninput="toggleClearButton()"
                                    />
                                    <span
                                      id="clearButton"
                                      class="clear-button"
                                      onclick="clearSearchField()"
                                      style="display: none;"
                                    >
                                      &#10005;
                                    </span>
                                  </div>
                                
                        </div>
                    <div class="shop__sidebar__accordion">
                        <div class="accordion" id="accordionExample">
                            <div class="card">
                                <div class="card-heading">
                                    <a data-toggle="collapse" data-target="#collapseOne">Categories</a>
                                </div>
                                <div id="collapseOne" class="collapse show" data-parent="#accordionExample">
                                    <div class="card-body">
                                        <div class="shop__sidebar__categories">
                                            <ul class="nice-scroll">
                                                
                                                <fieldset>
                                                <% categories.forEach(category=>{ %>
                                                        <div>
                                                            <input type="radio" id="huey" name="category" value="<%= category._id %>" checked>
                                                            <label for="huey" class="ms-2"><%= category.name  %></label>
                                                        </div>
                                                        <% }) %>
                                                    </fieldset>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="site-btn" type="submit">Find</button>
                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="shop__product__option">
                    <div class="row">
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__left">
                                <p>Showing <%= ((currentPage-1)*6)+1 %> - <%= (currentPage)*6 > totalDocuments? totalDocuments : (currentPage)*6 %> of <%= totalDocuments %> results</p>
                            </div>
                        </div>
                        
                        <div class="col-lg-6 col-md-6 col-sm-6">
                            <div class="shop__product__option__right">
                                <p>Sort by Price:</p>
                                <select id="sortBy" name="sortBy">
                                    <option value="price_low">Low To High</option>
                                    <option value="price_high">High To Low</option>
                                </select>
                            </div>
                        </form>
                        </div>
                    </div>
                </div>
                <div class="row">
                 <div id="resultHtml">
                  <%= shopItems  %>
                 </div>
                    
                </div>
                
                <div class="row">
                    <div class="col-lg-12">
                        <div class="product__pagination">
                            <% for(let i=1;i<=pages;i++){ %>
                                <% if(currentPage == i){ %>
                                    <a class="active" href="/shop/?pageNum=<%= i %>"><%= i %></a>
                                    <% }else{ %>
                                        <a class="" href="/shop/?pageNum=<%= i %>"><%= i %></a>
                                        <% } %>
                                <% } %>
                        </div>
                    </div>
                </div>
            
        </div>
    </div>
</section>
<!-- Shop Section End -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

<script>
  $(document).ready(function() {
  const {generateResult} = require('../../helpers/userHelper')
 $("#products-list-form").submit((e) => {
   e.preventDefault();
   let searchKeyword = $('#searchItem').val().trim();
   let category = $("input[name='category']:checked").val();
   let sortBy = $("#sortBy").val();
   console.log(category);
 
   let url = "/shop";
 
   let hasQueryParams = false;
 
   if (searchKeyword !== "") {
     url += "?search=" + encodeURIComponent(searchKeyword);
     hasQueryParams = true;
   }
 
   if (category !== "") {
     url += (hasQueryParams ? "&" : "?") + "category=" + encodeURIComponent(category);
     hasQueryParams = true;
   }
 
   if (sortBy !== "") {
     url += (hasQueryParams ? "&" : "?") + "sort=" + encodeURIComponent(sortBy);
   }
 
   console.log(url);
   // Send AJAX request
   $.ajax({
     url: url,
     method: "get",
     success: function (response) {
       console.log("hello",response);
       const result = generateResult(response)
       console.log(result);
       $('resultHtml').html(result)
     },
     error: function (xhr, status, error) {
       console.error(error);
     }
   });
 });
})
 
 </script>

<script>
    function toggleClearButton() {
      var searchItem = document.getElementById("searchItem");
      var clearButton = document.getElementById("clearButton");

      if (searchItem.value.length > 0) {
        clearButton.style.display = "block";
      } else {
        clearButton.style.display = "none";
      }
    }

    function clearSearchField() {
      var searchItem = document.getElementById("searchItem");
      searchItem.value = "";
      toggleClearButton();
    }
  </script>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>  
    function addToCart(productId){
            let cartCount = document.getElementById('cartCount')
            $.ajax({
                url:'/add-to-cart',
                data:{productId},
                method:'post',
                success:(response)=>{
                    if(response.status){
                        cartCount.innerHTML = response.cartCount
                        showSuccessModal()
                    }else{
                        showErrorModal()
                        setTimeout(()=>{
                            location.href = '/user-signin';
                        },1000)
                    }
                }
            })
        }

    

        function showSuccessModal() {
    Swal.fire({
      icon: 'success',
      title: 'Success!',
      text: 'Product added to cart.',
      timer: 1000, // Set the timer to 2000 milliseconds (2 seconds)
      showConfirmButton: false, // Hide the "OK" button
      background: '#f8f9fa', // Set a custom background color
      iconColor: '#28a745', // Set a custom icon color
      padding: '2rem', // Increase the padding
      width: '300px', // Set a custom width
      customClass: {
        title: 'my-success-modal-title', // Add a custom CSS class to the title
        content: 'my-success-modal-content', // Add a custom CSS class to the content
      },
      didOpen: () => {
        // Custom animations or actions when the modal opens
        // For example, you can use GSAP or CSS animations
        // Here's an example using GSAP:
        gsap.from('.swal-icon', { opacity: 0, scale: 0, duration: 0.5 });
        gsap.from('.my-success-modal-title', { opacity: 0, y: -20, duration: 0.5, delay: 0.2 });
        gsap.from('.my-success-modal-content', { opacity: 0, y: 20, duration: 0.5, delay: 0.2 });
      },
    });
  }

  function showErrorModal() {
    Swal.fire({
      icon: 'error',
      title: 'Login Required',
      text: 'Please Login for Add to Cart',
      showConfirmButton: false,
    });
  }

</script>